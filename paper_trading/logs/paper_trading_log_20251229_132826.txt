/Users/Algo_Trading/manishsir_options/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(

================================================================================
UNIVERSAL PAPER TRADING SYSTEM
================================================================================

Loading configuration...
Loading credentials from: paper_trading/config/credentials_zerodha.txt
Creating broker instance...
‚úì Broker: Zerodha

[2025-12-29 13:28:27.221551+05:30] Checking for previous session...
[2025-12-29 13:28:27.221729+05:30] ‚úì State loaded from paper_trading/state/trading_state_20251229.json
[2025-12-29 13:28:27.221746+05:30] Previous state found but no active positions - starting fresh

[2025-12-29 13:28:27.221752+05:30] Connecting to Zerodha...
[2025-12-29 13:28:27.221760] Connecting to Zerodha...
[2025-12-29 13:28:27.406411] Generated TOTP: 666471
[2025-12-29 13:28:27.501448] ‚úì Request token extracted from redirect
[2025-12-29 13:28:27.501468] Request token obtained: WhHHW40GedCwFtfRxSrP...
[2025-12-29 13:28:27.585042] ‚úì Connection successful!
[2025-12-29 13:28:27.585051] Access Token: Fyj6Os3a0vHmvzsHAJa1...
[2025-12-29 13:28:27.585085] Zerodha data feed initialized
[2025-12-29 13:28:27.585094+05:30] ‚úì Connected to Zerodha

[2025-12-29 13:28:27.585112+05:30] Initializing new session...
[2025-12-29 13:28:27.585485+05:30] Session initialized: SESSION_20251229_1328
[2025-12-29 13:28:27.585494+05:30] State file: paper_trading/state/trading_state_20251229.json
[2025-12-29 13:28:27.585511+05:30] Loading instruments...
[2025-12-29 13:28:27.585521] Loading instruments...
[2025-12-29 13:28:27.585526] Fetching instruments for NFO...
[2025-12-29 13:28:28.664635] ‚úì Retrieved 38153 instruments
[2025-12-29 13:28:28.670015] Fetching instruments for NSE...
[2025-12-29 13:28:28.777520] ‚úì Retrieved 9078 instruments
[2025-12-29 13:28:28.779925] ‚úì Nifty 50 token: 256265
[2025-12-29 13:28:28.779935] ‚úì Instruments loaded
[2025-12-29 13:28:28.779941+05:30] Initializing paper broker...
[2025-12-29 13:28:28.780426] Paper Broker initialized with capital: ‚Çπ100,000.00
[2025-12-29 13:28:28.780439] Trade log: paper_trading/logs/trades_20251229_132828.csv
[2025-12-29 13:28:28.780449+05:30] Initializing OI analyzer...
[2025-12-29 13:28:28.780741+05:30] Initializing strategy...
[2025-12-29 13:28:28.780765] Strategy initialized
  Entry: 09:30:00 - 14:30:00
  Exit: 14:50:00 - 15:00:00
  Stop Loss: 25.0%
  Trailing Stop: 10.0%
  VWAP Stop: 5.0%
  OI Stop: 10.0%
[2025-12-29 13:28:28.781010+05:30] ‚úì All components initialized

================================================================================
[2025-12-29 13:28:28.781028+05:30] Starting DUAL-LOOP paper trading...
  Broker: Zerodha
  Loop 1: Strategy Loop - Every 5 minutes (Entry decisions)
  Loop 2: Exit Monitor Loop - Every 1 minute (LTP-based exits)
================================================================================

[2025-12-29 13:28:28.781136+05:30] ‚úì Exit monitor loop started (1-min LTP)
[2025-12-29 13:28:28.781164+05:30] ‚úì Exit monitor loop started
[2025-12-29 13:28:28.781415+05:30] ‚úì Strategy loop started

================================================================================
[2025-12-29 13:28:28.781423+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 13:28:28.781423+05:30] Nifty Spot: 25949.85
[2025-12-29 13:28:28.819104] Fetching quotes for 22 options...
[2025-12-29 13:28:28.853703] ‚úì Retrieved 22 option quotes

================================================================================
[2025-12-29 13:28:28.781423+05:30] ‚ö†Ô∏è  STARTED LATE (after 9:15 AM)
[2025-12-29 13:28:28.781423+05:30] Determining direction using CURRENT OI data...
[2025-12-29 13:28:28.781423+05:30] (OI buildup direction is still valid mid-day)
================================================================================


================================================================================
[2025-12-29 13:28:28.781423+05:30] NEW TRADING DAY: 2025-12-29
================================================================================
[2025-12-29 13:28:28.781423+05:30] Max Call OI: 34,876,350 @ 26000.0, Max Put OI: 17,766,875 @ 26000.0
[2025-12-29 13:28:28.781423+05:30] Direction determined: PUT (Call dist: 50.15, Put dist: -50.15)
[2025-12-29 13:28:28.781423+05:30] ‚úì Daily Analysis Complete: Direction=PUT, Strike=25900.0, Expiry=2025-12-30, Spot=25949.85
[2025-12-29 13:28:28.781423+05:30] üîÑ Reset VWAP running totals for new day: 2025-12-29
[2025-12-29 13:28:28.781423+05:30] üéØ Initialized VWAP for PUT 25900.0: 51 bars from 9:15 AM
[2025-12-29 13:28:28.781423+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-29 13:28:28.781423+05:30] PUT 25900.0: OI=15,527,700, Change=0 (+0.00%) - BUILDING
[2025-12-29 13:28:28.781423+05:30] PUT 25900.0: Price=‚Çπ24.10, VWAP=‚Çπ24.10 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:28:28] Waiting 91s for next candle at 13:30:00

================================================================================
[2025-12-29 13:30:00.004865+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 13:30:00.004865+05:30] Nifty Spot: 25948.10
[2025-12-29 13:30:00.054192] Fetching quotes for 22 options...
[2025-12-29 13:30:00.085927] ‚úì Retrieved 22 option quotes
[2025-12-29 13:30:00.004865+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-29 13:30:00.004865+05:30] PUT 25900.0: OI=15,699,000, Change=171,300 (+1.10%) - BUILDING
[2025-12-29 13:30:00.004865+05:30] PUT 25900.0: Price=‚Çπ24.95, VWAP=‚Çπ24.53 - ABOVE ‚úì

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:30:00] Waiting 300s for next candle at 13:35:00

================================================================================
[2025-12-29 13:35:00.002703+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 13:35:30.016037] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2025-12-29 13:35:30.016083] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-29 13:35:00.002703+05:30] Nifty Spot: 25946.20
[2025-12-29 13:35:31.115659] Fetching quotes for 22 options...
[2025-12-29 13:35:31.153853] ‚úì Retrieved 22 option quotes
[2025-12-29 13:35:00.002703+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-29 13:35:00.002703+05:30] PUT 25900.0: OI=15,835,200, Change=307,500 (+1.98%) - BUILDING
[2025-12-29 13:35:00.002703+05:30] PUT 25900.0: Price=‚Çπ25.25, VWAP=‚Çπ24.77 - ABOVE ‚úì

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:35:31] Waiting 269s for next candle at 13:40:00

================================================================================
[2025-12-29 13:40:00.006120+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 13:40:26.086255] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-29 13:40:26.086305] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-29 13:40:00.006120+05:30] Nifty Spot: 25934.70
[2025-12-29 13:40:27.215591] Fetching quotes for 22 options...
[2025-12-29 13:40:27.267150] ‚úì Retrieved 22 option quotes
[2025-12-29 13:40:00.006120+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-29 13:40:00.006120+05:30] PUT 25900.0: OI=14,440,350, Change=-1,087,350 (-7.00%) - UNWINDING ‚úì
[2025-12-29 13:40:00.006120+05:30] PUT 25900.0: Price=‚Çπ36.60, VWAP=‚Çπ27.93 - ABOVE ‚úì
[2025-12-29 13:40:00.006120+05:30] üéØ ENTRY SIGNAL: PUT 25900.0 - Price: 36.60, VWAP: 27.93, OI Change: -1,087,350 (-7.00%)
[2025-12-29 13:40:00.006120+05:30] üìà PLACING BUY ORDER: size=1, expected_price=36.60
[2025-12-29 13:40:27.268431] ‚úì BUY ORDER EXECUTED
  Strike: 25900.0 PUT
  Expiry: 2025-12-30
  Entry Price: ‚Çπ36.60
  Size: 75
  Cost: ‚Çπ2,745.00
  VWAP: ‚Çπ27.93
  OI: 14,440,350 (Change: -700.26%)
  Remaining Cash: ‚Çπ97,255.00
[2025-12-29 13:40:00.006120+05:30] üîµ BUY OPTION EXECUTED: PUT 25900.0 @ ‚Çπ36.60 (Expiry: 2025-12-30, 1 lot = 75 qty)
[2025-12-29 13:40:00.006120+05:30]    üìä ENTRY DATA: VWAP=27.93, OI=14,440,350, OI Change=-1,087,350 (-7.00%)

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:40:27] Waiting 273s for next candle at 13:45:00

================================================================================
[2025-12-29 13:45:00.006494+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 13:45:26.520126] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-29 13:45:26.520176] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-29 13:45:00.006494+05:30] Nifty Spot: 25943.05
[2025-12-29 13:45:27.616881] Fetching quotes for 22 options...
[2025-12-29 13:45:27.651683] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:45:27] Waiting 272s for next candle at 13:50:00

================================================================================
[2025-12-29 13:50:00.004488+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 13:50:25.005439] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-29 13:50:25.005490] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-29 13:50:00.004488+05:30] Nifty Spot: 25948.30
[2025-12-29 13:50:26.100335] Fetching quotes for 22 options...
[2025-12-29 13:50:26.151263] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:50:26] Waiting 274s for next candle at 13:55:00

================================================================================
[2025-12-29 13:55:00.009473+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 13:55:30.015538] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2025-12-29 13:55:30.015572] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-29 13:55:00.009473+05:30] Nifty Spot: 25953.70
[2025-12-29 13:55:31.094538] Fetching quotes for 22 options...
[2025-12-29 13:55:31.127746] ‚úì Retrieved 22 option quotes
[2025-12-29 13:55:00.009473+05:30] EXIT SIGNAL: Stop Loss (25%)
[2025-12-29 13:55:31.130930] ‚úì SELL ORDER EXECUTED
  Strike: 25900.0 PUT
  Exit Price: ‚Çπ26.40
  P&L: ‚Çπ-765.00 (-27.87%)
  Exit Reason: Stop Loss (25%)
  Cash: ‚Çπ99,235.00

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-765.00
ROI: -0.77%
--------------------------------------------------------------------------------

[13:55:31] Waiting 269s for next candle at 14:00:00

================================================================================
[2025-12-29 14:00:00.004411+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 14:00:25.014926] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-29 14:00:25.014975] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-29 14:00:00.004411+05:30] Nifty Spot: 25949.90
[2025-12-29 14:00:26.106824] Fetching quotes for 22 options...
[2025-12-29 14:00:26.138596] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-765.00
ROI: -0.77%
--------------------------------------------------------------------------------

[14:00:26] Waiting 274s for next candle at 14:05:00

================================================================================
[2025-12-29 14:05:00.032790+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 14:05:22.982636] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-29 14:05:22.982692] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-29 14:05:00.032790+05:30] Nifty Spot: 25951.25
[2025-12-29 14:05:24.079798] Fetching quotes for 22 options...
[2025-12-29 14:05:24.115044] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-765.00
ROI: -0.77%
--------------------------------------------------------------------------------

[14:05:24] Waiting 276s for next candle at 14:10:00

================================================================================
[2025-12-29 14:10:00.005925+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-29 14:10:26.050773] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-29 14:10:26.050819] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-29 14:10:00.005925+05:30] Nifty Spot: 25958.10
[2025-12-29 14:10:27.142297] Fetching quotes for 22 options...
[2025-12-29 14:10:27.182073] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-29
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-765.00
ROI: -0.77%
--------------------------------------------------------------------------------

[14:10:27] Waiting 273s for next candle at 14:15:00

================================================================================
