/Users/Algo_Trading/manishsir_options/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(

================================================================================
UNIVERSAL PAPER TRADING SYSTEM
================================================================================

Loading configuration...
Loading credentials from: paper_trading/config/credentials_zerodha.txt
Creating broker instance...
‚úì Broker: Zerodha

[2025-12-30 14:05:49.663799+05:30] Checking for previous session...
[2025-12-30 14:05:49.663874+05:30] No previous state found - starting fresh

[2025-12-30 14:05:49.663883+05:30] Connecting to Zerodha...
[2025-12-30 14:05:49.663892] Connecting to Zerodha...
[2025-12-30 14:05:49.944185] Generated TOTP: 255827
[2025-12-30 14:05:50.025113] ‚úì Request token extracted from redirect
[2025-12-30 14:05:50.025138] Request token obtained: Y3gfmskTjlqSceTHT06X...
[2025-12-30 14:05:50.102535] ‚úì Connection successful!
[2025-12-30 14:05:50.102548] Access Token: HVGU6h8Ixfzs8ojX6qSv...
[2025-12-30 14:05:50.102561] Zerodha data feed initialized
[2025-12-30 14:05:50.102565+05:30] ‚úì Connected to Zerodha

[2025-12-30 14:05:50.102576+05:30] Initializing new session...
[2025-12-30 14:05:50.102979+05:30] Session initialized: SESSION_20251230_1405
[2025-12-30 14:05:50.102989+05:30] State file: paper_trading/state/trading_state_20251230.json
[2025-12-30 14:05:50.103003+05:30] Loading instruments...
[2025-12-30 14:05:50.103008] Loading instruments...
[2025-12-30 14:05:50.103011] Fetching instruments for NFO...
[2025-12-30 14:05:50.829632] ‚úì Retrieved 38222 instruments
[2025-12-30 14:05:50.832278] Fetching instruments for NSE...
[2025-12-30 14:05:50.936552] ‚úì Retrieved 9057 instruments
[2025-12-30 14:05:50.937934] ‚úì Nifty 50 token: 256265
[2025-12-30 14:05:50.937944] ‚úì Instruments loaded
[2025-12-30 14:05:50.937949+05:30] Initializing paper broker...
[2025-12-30 14:05:50.938222] Paper Broker initialized with capital: ‚Çπ100,000.00
[2025-12-30 14:05:50.938229] Trade log: paper_trading/logs/trades_20251230_140550.csv
[2025-12-30 14:05:50.938236+05:30] Initializing OI analyzer...
[2025-12-30 14:05:50.938407+05:30] Initializing strategy...
[2025-12-30 14:05:50.938422] Strategy initialized
  Entry: 09:30:00 - 15:29:00
  Exit: 15:29:00 - 15:30:00
  Stop Loss: 25.0%
  Trailing Stop: 10.0%
  VWAP Stop: 5.0%
  OI Stop: 10.0%
[2025-12-30 14:05:50.938591+05:30] ‚úì All components initialized

================================================================================
[2025-12-30 14:05:50.938599+05:30] Starting DUAL-LOOP paper trading...
  Broker: Zerodha
  Loop 1: Strategy Loop - Every 5 minutes (Entry decisions)
  Loop 2: Exit Monitor Loop - Every 1 minute (LTP-based exits)
================================================================================

[2025-12-30 14:05:50.938663+05:30] ‚úì Exit monitor loop started (1-min LTP)
[2025-12-30 14:05:50.938682+05:30] ‚úì Exit monitor loop started
[2025-12-30 14:05:50.938806+05:30] ‚úì Strategy loop started

================================================================================
[2025-12-30 14:05:50.938812+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 14:05:50.938812+05:30] Nifty Spot: 25942.35
[2025-12-30 14:05:50.974463] Fetching quotes for 22 options...
[2025-12-30 14:05:51.005577] ‚úì Retrieved 22 option quotes

================================================================================
[2025-12-30 14:05:50.938812+05:30] ‚ö†Ô∏è  STARTED LATE (after 9:15 AM)
[2025-12-30 14:05:50.938812+05:30] Determining direction using CURRENT OI data...
[2025-12-30 14:05:50.938812+05:30] (OI buildup direction is still valid mid-day)
================================================================================


================================================================================
[2025-12-30 14:05:50.938812+05:30] NEW TRADING DAY: 2025-12-30
================================================================================
[2025-12-30 14:05:50.938812+05:30] Max Call OI: 42,517,550 @ 26000.0, Max Put OI: 50,170,200 @ 25900.0
[2025-12-30 14:05:50.938812+05:30] Direction determined: PUT (Call dist: 57.65, Put dist: 42.35)
[2025-12-30 14:05:50.938812+05:30] ‚úì Daily Analysis Complete: Direction=PUT, Strike=25900.0, Expiry=2025-12-30, Spot=25942.35
[2025-12-30 14:05:50.938812+05:30] üîÑ Reset VWAP running totals for new day: 2025-12-30
[2025-12-30 14:05:50.938812+05:30] üéØ Initialized VWAP for PUT 25900.0: 59 bars from 9:15 AM
[2025-12-30 14:05:50.938812+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 14:05:50.938812+05:30] PUT 25900.0: OI=50,170,200, Change=0 (+0.00%) - BUILDING
[2025-12-30 14:05:50.938812+05:30] PUT 25900.0: Price=‚Çπ5.15, VWAP=‚Çπ5.15 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[14:05:51] Waiting 249s for next candle at 14:10:00

================================================================================
[2025-12-30 14:10:00.012742+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 14:10:30.021462] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2025-12-30 14:10:30.021524] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 14:10:00.012742+05:30] Nifty Spot: 25939.55
[2025-12-30 14:10:31.112827] Fetching quotes for 22 options...
[2025-12-30 14:10:31.145554] ‚úì Retrieved 22 option quotes
[2025-12-30 14:10:00.012742+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 14:10:00.012742+05:30] PUT 25900.0: OI=50,825,850, Change=655,650 (+1.31%) - BUILDING
[2025-12-30 14:10:00.012742+05:30] PUT 25900.0: Price=‚Çπ5.90, VWAP=‚Çπ5.53 - ABOVE ‚úì

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[14:10:31] Waiting 269s for next candle at 14:15:00

================================================================================
[2025-12-30 14:15:00.006582+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 14:15:26.576663] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 14:15:26.576741] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 14:15:00.006582+05:30] Nifty Spot: 25944.00
[2025-12-30 14:15:27.655537] Fetching quotes for 22 options...
[2025-12-30 14:15:27.690422] ‚úì Retrieved 22 option quotes
[2025-12-30 14:15:00.006582+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 14:15:00.006582+05:30] PUT 25900.0: OI=51,214,500, Change=1,044,300 (+2.08%) - BUILDING
[2025-12-30 14:15:00.006582+05:30] PUT 25900.0: Price=‚Çπ4.25, VWAP=‚Çπ5.09 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[14:15:27] Waiting 272s for next candle at 14:20:00

================================================================================
[2025-12-30 14:20:00.006618+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 14:20:26.019053] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 14:20:26.019123] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 14:20:00.006618+05:30] Nifty Spot: 25947.70
[2025-12-30 14:20:27.097918] Fetching quotes for 22 options...
[2025-12-30 14:20:27.122934] ‚úì Retrieved 22 option quotes
[2025-12-30 14:20:00.006618+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 14:20:00.006618+05:30] PUT 25900.0: OI=48,945,750, Change=-1,224,450 (-2.44%) - UNWINDING ‚úì
[2025-12-30 14:20:00.006618+05:30] PUT 25900.0: Price=‚Çπ3.15, VWAP=‚Çπ4.59 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[14:20:27] Waiting 273s for next candle at 14:25:00

================================================================================
[2025-12-30 14:25:00.006611+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 14:25:18.307134] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 14:25:18.307206] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 14:25:00.006611+05:30] Nifty Spot: 25936.60
[2025-12-30 14:25:19.384765] Fetching quotes for 22 options...
[2025-12-30 14:25:19.418870] ‚úì Retrieved 22 option quotes
[2025-12-30 14:25:00.006611+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 14:25:00.006611+05:30] PUT 25900.0: OI=50,009,550, Change=-160,650 (-0.32%) - UNWINDING ‚úì
[2025-12-30 14:25:00.006611+05:30] PUT 25900.0: Price=‚Çπ5.00, VWAP=‚Çπ4.67 - ABOVE ‚úì
[2025-12-30 14:25:00.006611+05:30] üéØ ENTRY SIGNAL: PUT 25900.0 - Price: 5.00, VWAP: 4.67, OI Change: -160,650 (-0.32%)
[2025-12-30 14:25:00.006611+05:30] üìà PLACING BUY ORDER: size=1, expected_price=5.00
[2025-12-30 14:25:19.420404] ‚úì BUY ORDER EXECUTED
  Strike: 25900.0 PUT
  Expiry: 2025-12-30
  Entry Price: ‚Çπ5.00
  Size: 75
  Cost: ‚Çπ375.00
  VWAP: ‚Çπ4.67
  OI: 50,009,550 (Change: -32.02%)
  Remaining Cash: ‚Çπ99,625.00
[2025-12-30 14:25:00.006611+05:30] üîµ BUY OPTION EXECUTED: PUT 25900.0 @ ‚Çπ5.00 (Expiry: 2025-12-30, 1 lot = 75 qty)
[2025-12-30 14:25:00.006611+05:30]    üìä ENTRY DATA: VWAP=4.67, OI=50,009,550, OI Change=-160,650 (-0.32%)

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[14:25:19] Waiting 281s for next candle at 14:30:00
[2025-12-30 14:25:51.049788+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-30 14:25:51.105375] Fetching quotes for 22 options...
[2025-12-30 14:25:51.132135] ‚úì Retrieved 22 option quotes
[2025-12-30 14:25:51.049788+05:30] üéØ Trailing stop ACTIVATED for 25900.0 PUT
[2025-12-30 14:25:51.049788+05:30] üìä LTP CHECK: 25900.0 PUT
    Current LTP: ‚Çπ7.60 | Entry: ‚Çπ5.00 | P&L: +52.00%
    Initial Stop: ‚Çπ3.75 (distance: 102.67%)
    üéØ Trailing: Active | Peak: ‚Çπ7.60 | Stop: ‚Çπ6.84
[2025-12-30 14:26:51.134141+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-30 14:26:51.210676] Fetching quotes for 22 options...
[2025-12-30 14:26:51.238709] ‚úì Retrieved 22 option quotes
[2025-12-30 14:26:51.134141+05:30] üìä LTP CHECK: 25900.0 PUT
    Current LTP: ‚Çπ6.70 | Entry: ‚Çπ5.00 | P&L: +34.00%
    Initial Stop: ‚Çπ3.75 (distance: 78.67%)
    üéØ Trailing: Active | Peak: ‚Çπ7.60 | Stop: ‚Çπ6.84
[2025-12-30 14:26:51.134141+05:30] EXIT SIGNAL: Trailing Stop (10%)
[2025-12-30 14:26:51.240476] ‚úì SELL ORDER EXECUTED
  Strike: 25900.0 PUT
  Exit Price: ‚Çπ6.70
  P&L: ‚Çπ+127.50 (+34.00%)
  Exit Reason: Trailing Stop (10%)
  Cash: ‚Çπ100,127.50

================================================================================
[2025-12-30 14:29:59.999381+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 14:29:59.999381+05:30] Nifty Spot: 25916.60
[2025-12-30 14:30:00.051204] Fetching quotes for 22 options...
[2025-12-30 14:30:00.082458] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ127.50
ROI: +0.13%
--------------------------------------------------------------------------------

[14:30:00] Waiting 300s for next candle at 14:35:00
