/Users/Algo_Trading/manishsir_options/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(

================================================================================
UNIVERSAL PAPER TRADING SYSTEM
================================================================================

Loading configuration...
Loading credentials from: paper_trading/config/credentials_zerodha.txt
Creating broker instance...
‚úì Broker: Zerodha

[2025-12-31 13:53:04.195061+05:30] Checking for previous session...
[2025-12-31 13:53:04.195240+05:30] ‚úì State loaded from paper_trading/state/trading_state_20251231.json

================================================================================
CRASH RECOVERY DETECTED
================================================================================
Last Activity: 2025-12-31T13:44:33.140614+05:30
Downtime: ~8 minutes
Active Positions: 1
Daily P&L: ‚Çπ0.00
================================================================================

‚ö†Ô∏è  CRITICAL: 1 open position(s) detected!
Cannot start fresh session with active positions.
Automatically resuming from crash...


================================================================================
RESUMING SESSION FROM CRASH
================================================================================
Crash Time: 2025-12-31T13:44:33.140614+05:30
Recovery Time: 2025-12-31 13:53:04.195316+05:30
Downtime: 8 minutes
Active Positions: 1
‚úì Session resumed successfully
================================================================================


[2025-12-31 13:53:04.195716+05:30] Connecting to Zerodha...
[2025-12-31 13:53:04.195732] Connecting to Zerodha...
[2025-12-31 13:53:04.410625] Generated TOTP: 054171
[2025-12-31 13:53:04.507613] ‚úì Request token extracted from redirect
[2025-12-31 13:53:04.507636] Request token obtained: 4Z5EOKhpOExxfYcR5zR2...
[2025-12-31 13:53:04.554612] ‚úì Connection successful!
[2025-12-31 13:53:04.554638] Access Token: M2c5aDKqTGSN0RkAThrk...
[2025-12-31 13:53:04.554669] Zerodha data feed initialized
[2025-12-31 13:53:04.554677+05:30] ‚úì Connected to Zerodha

[2025-12-31 13:53:04.554704+05:30] Resuming from previous session...
[2025-12-31 13:53:04.554730+05:30] Loading instruments...
[2025-12-31 13:53:04.554739] Loading instruments...
[2025-12-31 13:53:04.554749] Fetching instruments for NFO...
[2025-12-31 13:53:05.623797] ‚úì Retrieved 37220 instruments
[2025-12-31 13:53:05.629831] Fetching instruments for NSE...
[2025-12-31 13:53:05.742481] ‚úì Retrieved 9058 instruments
[2025-12-31 13:53:05.745673] ‚úì Nifty 50 token: 256265
[2025-12-31 13:53:05.745696] ‚úì Instruments loaded
[2025-12-31 13:53:05.745706+05:30] Initializing paper broker...
[2025-12-31 13:53:05.746326] Paper Broker initialized with capital: ‚Çπ92,072.50
[2025-12-31 13:53:05.746339] Daily trade log: paper_trading/logs/trades_20251231_135305.csv
[2025-12-31 13:53:05.746343] Cumulative trade log: paper_trading/logs/trades_cumulative.csv
[2025-12-31 13:53:05.746355] Restoring 1 position(s)...
  ‚úì Restored: CALL 26050.0 @ ‚Çπ107.40
     Size: 75, Peak: ‚Çπ194.60, Trailing: True
[2025-12-31 13:53:05.746384] ‚úì Restored 1 position(s)
[2025-12-31 13:53:05.746388] Available cash: ‚Çπ92,072.50
[2025-12-31 13:53:05.746393+05:30] Initializing OI analyzer...
[2025-12-31 13:53:05.746771+05:30] Initializing strategy...
[2025-12-31 13:53:05.746804] Strategy initialized
  Entry: 09:30:00 - 14:30:00
  Exit: 14:50:00 - 15:00:00
  Stop Loss: 25.0%
  Trailing Stop: 10.0%
  VWAP Stop: 5.0%
  OI Stop: 10.0%
[2025-12-31 13:53:05.746825+05:30] Restoring strategy state...
  Restored daily_trade_taken: True (has open positions)
  Restored direction: CALL
  Restored strike: 26150.0
  Restored expiry: 2026-01-06
[2025-12-31 13:53:05.747223+05:30] ‚úì All components initialized

================================================================================
[2025-12-31 13:53:05.747237+05:30] Starting DUAL-LOOP paper trading...
  Broker: Zerodha
  Loop 1: Strategy Loop - Every 5 minutes (Entry decisions)
  Loop 2: Exit Monitor Loop - Every 1 minute (LTP-based exits)
  MODE: RECOVERY (resumed from crash)
================================================================================

[2025-12-31 13:53:05.747386+05:30] ‚úì Exit monitor loop started (1-min LTP)
[2025-12-31 13:53:05.747576+05:30] ‚úì Exit monitor loop started
[2025-12-31 13:53:05.748522+05:30] ‚úì Strategy loop started

================================================================================
[2025-12-31 13:53:05.748533+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 13:53:05.747409+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:53:05.790160] Fetching quotes for 22 options...
[2025-12-31 13:53:05.748533+05:30] Nifty Spot: 26157.85
[2025-12-31 13:53:05.821492] Fetching quotes for 22 options...
[2025-12-31 13:53:05.825003] ‚úì Retrieved 22 option quotes
[2025-12-31 13:53:05.747409+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ191.85 | Entry: ‚Çπ107.40 | P&L: +78.63%
    Initial Stop: ‚Çπ80.55 (distance: 138.18%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14
[2025-12-31 13:53:05.850970] ‚úì Retrieved 22 option quotes

================================================================================
[2025-12-31 13:53:05.748533+05:30] ‚ö†Ô∏è  STARTED LATE (after 9:15 AM)
[2025-12-31 13:53:05.748533+05:30] Determining direction using CURRENT OI data...
[2025-12-31 13:53:05.748533+05:30] (OI buildup direction is still valid mid-day)
================================================================================


================================================================================
[2025-12-31 13:53:05.748533+05:30] NEW TRADING DAY: 2025-12-31
================================================================================
[2025-12-31 13:53:05.748533+05:30] ‚ö†Ô∏è  Open positions detected - keeping daily_trade_taken = True

================================================================================
OI DISTRIBUTION DEBUG (Spot: 26157.85)
================================================================================

CALL OI by Strike:
Strike                  OI   Distance from Spot
--------------------------------------------------
25900.0          1,401,140            -257.85
25950.0            970,515            -207.85
26000.0          5,618,015            -157.85
26050.0          2,226,250            -107.85
26100.0          5,736,315             -57.85
26150.0          4,471,025              -7.85
26200.0          8,013,655              42.15 üëà MAX
26250.0          3,194,165              92.15
26300.0          5,851,950             142.15
26350.0          2,816,450             192.15
26400.0          7,115,290             242.15

PUT OI by Strike:
Strike                  OI   Distance from Spot
--------------------------------------------------
25900.0          9,142,185             257.85
25950.0          6,258,525             207.85
26000.0         20,099,105             157.85 üëà MAX
26050.0          9,218,690             107.85
26100.0         13,202,670              57.85
26150.0          6,711,705               7.85
26200.0          7,105,865             -42.15
26250.0          1,513,005             -92.15
26300.0          2,454,530            -142.15
26350.0            429,065            -192.15
26400.0            575,640            -242.15
================================================================================

[2025-12-31 13:53:05.748533+05:30] Max Call OI: 8,013,655 @ 26200.0, Max Put OI: 20,099,105 @ 26000.0
[2025-12-31 13:53:05.748533+05:30] Direction determined: CALL (Call dist: 42.15, Put dist: 157.85)
[2025-12-31 13:53:05.748533+05:30] ‚úì Daily Analysis Complete: Direction=CALL, Strike=26200.0, Expiry=2026-01-06, Spot=26157.85
[2025-12-31 13:53:05.748533+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ191.85 | Entry: ‚Çπ107.40 | P&L: +78.63%
    Initial Stop: ‚Çπ80.55 (distance: 138.18%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26200.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:53:05] Waiting 114s for next candle at 13:55:00
[2025-12-31 13:54:05.832829+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:54:05.891599] Fetching quotes for 22 options...
[2025-12-31 13:54:05.936598] ‚úì Retrieved 22 option quotes
[2025-12-31 13:54:05.832829+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ192.40 | Entry: ‚Çπ107.40 | P&L: +79.14%
    Initial Stop: ‚Çπ80.55 (distance: 138.86%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14

================================================================================
[2025-12-31 13:55:00.005669+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 13:55:00.005669+05:30] Nifty Spot: 26158.50
[2025-12-31 13:55:00.053003] Fetching quotes for 22 options...
[2025-12-31 13:55:00.100788] ‚úì Retrieved 22 option quotes
[2025-12-31 13:55:00.005669+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ192.00 | Entry: ‚Çπ107.40 | P&L: +78.77%
    Initial Stop: ‚Çπ80.55 (distance: 138.36%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26200.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:55:00] Waiting 300s for next candle at 14:00:00
[2025-12-31 13:55:05.943978+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:55:06.022087] Fetching quotes for 22 options...
[2025-12-31 13:55:06.057726] ‚úì Retrieved 22 option quotes
[2025-12-31 13:55:05.943978+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ192.50 | Entry: ‚Çπ107.40 | P&L: +79.24%
    Initial Stop: ‚Çπ80.55 (distance: 138.98%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14
[2025-12-31 13:56:06.064726+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:56:06.124941] Fetching quotes for 22 options...
[2025-12-31 13:56:06.160975] ‚úì Retrieved 22 option quotes
[2025-12-31 13:56:06.064726+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ193.00 | Entry: ‚Çπ107.40 | P&L: +79.70%
    Initial Stop: ‚Çπ80.55 (distance: 139.60%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14
