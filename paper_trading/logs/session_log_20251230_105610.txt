/Users/Algo_Trading/manishsir_options/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(

================================================================================
UNIVERSAL PAPER TRADING SYSTEM
================================================================================

Loading configuration...
Loading credentials from: paper_trading/config/credentials_zerodha.txt
Creating broker instance...
‚úì Broker: Zerodha

[2025-12-30 10:56:11.603706+05:30] Checking for previous session...
[2025-12-30 10:56:11.603788+05:30] No previous state found - starting fresh

[2025-12-30 10:56:11.603800+05:30] Connecting to Zerodha...
[2025-12-30 10:56:11.603809] Connecting to Zerodha...
[2025-12-30 10:56:11.789768] Generated TOTP: 973831
[2025-12-30 10:56:11.878251] ‚úì Request token extracted from redirect
[2025-12-30 10:56:11.878272] Request token obtained: dUWjAS5qZXyk8Z4K2gcx...
[2025-12-30 10:56:11.968614] ‚úì Connection successful!
[2025-12-30 10:56:11.968658] Access Token: HVGU6h8Ixfzs8ojX6qSv...
[2025-12-30 10:56:11.968726] Zerodha data feed initialized
[2025-12-30 10:56:11.968748+05:30] ‚úì Connected to Zerodha

[2025-12-30 10:56:11.968807+05:30] Initializing new session...
[2025-12-30 10:56:11.970018+05:30] Session initialized: SESSION_20251230_1056
[2025-12-30 10:56:11.970035+05:30] State file: paper_trading/state/trading_state_20251230.json
[2025-12-30 10:56:11.970067+05:30] Loading instruments...
[2025-12-30 10:56:11.970084] Loading instruments...
[2025-12-30 10:56:11.970094] Fetching instruments for NFO...
[2025-12-30 10:56:13.102026] ‚úì Retrieved 38222 instruments
[2025-12-30 10:56:13.106373] Fetching instruments for NSE...
[2025-12-30 10:56:13.211000] ‚úì Retrieved 9057 instruments
[2025-12-30 10:56:13.218868] ‚úì Nifty 50 token: 256265
[2025-12-30 10:56:13.218885] ‚úì Instruments loaded
[2025-12-30 10:56:13.218894+05:30] Initializing paper broker...
[2025-12-30 10:56:13.219337] Paper Broker initialized with capital: ‚Çπ100,000.00
[2025-12-30 10:56:13.219353] Trade log: paper_trading/logs/trades_20251230_105613.csv
[2025-12-30 10:56:13.219366+05:30] Initializing OI analyzer...
[2025-12-30 10:56:13.219685+05:30] Initializing strategy...
[2025-12-30 10:56:13.219713] Strategy initialized
  Entry: 09:30:00 - 14:30:00
  Exit: 14:50:00 - 15:00:00
  Stop Loss: 25.0%
  Trailing Stop: 10.0%
  VWAP Stop: 5.0%
  OI Stop: 10.0%
[2025-12-30 10:56:13.219960+05:30] ‚úì All components initialized

================================================================================
[2025-12-30 10:56:13.219975+05:30] Starting DUAL-LOOP paper trading...
  Broker: Zerodha
  Loop 1: Strategy Loop - Every 5 minutes (Entry decisions)
  Loop 2: Exit Monitor Loop - Every 1 minute (LTP-based exits)
================================================================================

[2025-12-30 10:56:13.220130+05:30] ‚úì Exit monitor loop started (1-min LTP)
[2025-12-30 10:56:13.220176+05:30] ‚úì Exit monitor loop started
[2025-12-30 10:56:13.220437+05:30] ‚úì Strategy loop started

================================================================================
[2025-12-30 10:56:13.220449+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 10:56:13.220449+05:30] Nifty Spot: 25928.25
[2025-12-30 10:56:13.261603] Fetching quotes for 22 options...
[2025-12-30 10:56:13.326004] ‚úì Retrieved 22 option quotes

================================================================================
[2025-12-30 10:56:13.220449+05:30] ‚ö†Ô∏è  STARTED LATE (after 9:15 AM)
[2025-12-30 10:56:13.220449+05:30] Determining direction using CURRENT OI data...
[2025-12-30 10:56:13.220449+05:30] (OI buildup direction is still valid mid-day)
================================================================================


================================================================================
[2025-12-30 10:56:13.220449+05:30] NEW TRADING DAY: 2025-12-30
================================================================================
[2025-12-30 10:56:13.220449+05:30] Max Call OI: 36,595,925 @ 26000.0, Max Put OI: 38,819,025 @ 25900.0
[2025-12-30 10:56:13.220449+05:30] Direction determined: PUT (Call dist: 71.75, Put dist: 28.25)
[2025-12-30 10:56:13.220449+05:30] ‚úì Daily Analysis Complete: Direction=PUT, Strike=25900.0, Expiry=2025-12-30, Spot=25928.25
[2025-12-30 10:56:13.220449+05:30] üîÑ Reset VWAP running totals for new day: 2025-12-30
[2025-12-30 10:56:13.220449+05:30] üéØ Initialized VWAP for PUT 25900.0: 21 bars from 9:15 AM
[2025-12-30 10:56:13.220449+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 10:56:13.220449+05:30] PUT 25900.0: OI=38,819,025, Change=0 (+0.00%) - BUILDING
[2025-12-30 10:56:13.220449+05:30] PUT 25900.0: Price=‚Çπ20.00, VWAP=‚Çπ20.00 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[10:56:13] Waiting 227s for next candle at 11:00:00

================================================================================
[2025-12-30 11:00:00.005860+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:00:00.005860+05:30] Nifty Spot: 25927.90
[2025-12-30 11:00:00.055681] Fetching quotes for 22 options...
[2025-12-30 11:00:00.091461] ‚úì Retrieved 22 option quotes
[2025-12-30 11:00:00.005860+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 11:00:00.005860+05:30] PUT 25900.0: OI=38,653,725, Change=-165,300 (-0.43%) - UNWINDING ‚úì
[2025-12-30 11:00:00.005860+05:30] PUT 25900.0: Price=‚Çπ19.95, VWAP=‚Çπ19.97 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[11:00:00] Waiting 300s for next candle at 11:05:00

================================================================================
[2025-12-30 11:05:00.005893+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:05:30.026179] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2025-12-30 11:05:30.026242] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:05:00.005893+05:30] Nifty Spot: 25932.95
[2025-12-30 11:05:31.106104] Fetching quotes for 22 options...
[2025-12-30 11:05:31.141099] ‚úì Retrieved 22 option quotes
[2025-12-30 11:05:00.005893+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 11:05:00.005893+05:30] PUT 25900.0: OI=39,401,925, Change=582,900 (+1.50%) - BUILDING
[2025-12-30 11:05:00.005893+05:30] PUT 25900.0: Price=‚Çπ16.65, VWAP=‚Çπ18.83 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[11:05:31] Waiting 269s for next candle at 11:10:00

================================================================================
[2025-12-30 11:10:00.002141+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:10:22.441092] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 11:10:22.441195] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:10:00.002141+05:30] Nifty Spot: 25926.10
[2025-12-30 11:10:23.524738] Fetching quotes for 22 options...
[2025-12-30 11:10:23.558692] ‚úì Retrieved 22 option quotes
[2025-12-30 11:10:00.002141+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 11:10:00.002141+05:30] PUT 25900.0: OI=39,055,800, Change=236,775 (+0.61%) - BUILDING
[2025-12-30 11:10:00.002141+05:30] PUT 25900.0: Price=‚Çπ20.05, VWAP=‚Çπ19.15 - ABOVE ‚úì

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[11:10:23] Waiting 276s for next candle at 11:15:00

================================================================================
[2025-12-30 11:15:00.005793+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:15:23.988134] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 11:15:23.988200] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:15:00.005793+05:30] Nifty Spot: 25920.15
[2025-12-30 11:15:25.083930] Fetching quotes for 22 options...
[2025-12-30 11:15:25.113261] ‚úì Retrieved 22 option quotes
[2025-12-30 11:15:00.005793+05:30] Checking entry: PUT 25900.0, Expiry=2025-12-30
[2025-12-30 11:15:00.005793+05:30] PUT 25900.0: OI=38,216,850, Change=-602,175 (-1.55%) - UNWINDING ‚úì
[2025-12-30 11:15:00.005793+05:30] PUT 25900.0: Price=‚Çπ20.50, VWAP=‚Çπ19.44 - ABOVE ‚úì
[2025-12-30 11:15:00.005793+05:30] üéØ ENTRY SIGNAL: PUT 25900.0 - Price: 20.50, VWAP: 19.44, OI Change: -602,175 (-1.55%)
[2025-12-30 11:15:00.005793+05:30] üìà PLACING BUY ORDER: size=1, expected_price=20.50
[2025-12-30 11:15:25.114954+05:30] ‚úó Error saving state: Object of type int64 is not JSON serializable
[2025-12-30 11:15:25.114976] ‚úì BUY ORDER EXECUTED
  Strike: 25900.0 PUT
  Expiry: 2025-12-30
  Entry Price: ‚Çπ20.50
  Size: 75
  Cost: ‚Çπ1,537.50
  VWAP: ‚Çπ19.44
  OI: 38,216,850 (Change: -155.12%)
  Remaining Cash: ‚Çπ98,462.50
[2025-12-30 11:15:00.005793+05:30] üîµ BUY OPTION EXECUTED: PUT 25900.0 @ ‚Çπ20.50 (Expiry: 2025-12-30, 1 lot = 75 qty)
[2025-12-30 11:15:00.005793+05:30]    üìä ENTRY DATA: VWAP=19.44, OI=38,216,850, OI Change=-602,175 (-1.55%)
[2025-12-30 11:15:25.115193+05:30] ‚úó Error saving state: Object of type int64 is not JSON serializable

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[11:15:25] Waiting 275s for next candle at 11:20:00
[2025-12-30 11:16:13.247584+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-30 11:16:13.309880] Fetching quotes for 22 options...
[2025-12-30 11:16:13.349310] ‚úì Retrieved 22 option quotes
[2025-12-30 11:16:13.247584+05:30] üìä LTP CHECK: 25900.0 PUT
    Current LTP: ‚Çπ19.30 | Entry: ‚Çπ20.50 | P&L: -5.85%
    Initial Stop: ‚Çπ15.38 (distance: 25.53%)
    VWAP Stop: ‚Çπ18.45 | Current VWAP: ‚Çπ19.42
    OI Change: +0.00% (Threshold: 10%)
[2025-12-30 11:16:13.350571+05:30] ‚úó Error saving state: Object of type int64 is not JSON serializable
[2025-12-30 11:17:13.355309+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-30 11:17:13.416225] Fetching quotes for 22 options...
[2025-12-30 11:17:13.450974] ‚úì Retrieved 22 option quotes
[2025-12-30 11:17:13.355309+05:30] üìä LTP CHECK: 25900.0 PUT
    Current LTP: ‚Çπ17.45 | Entry: ‚Çπ20.50 | P&L: -14.88%
    Initial Stop: ‚Çπ15.38 (distance: 13.50%)
    VWAP Stop: ‚Çπ18.16 | Current VWAP: ‚Çπ19.12
    OI Change: +1.05% (Threshold: 10%)
[2025-12-30 11:17:13.355309+05:30] EXIT SIGNAL: VWAP Stop (>5% below VWAP)
[2025-12-30 11:17:13.453008] ‚úì SELL ORDER EXECUTED
  Strike: 25900.0 PUT
  Exit Price: ‚Çπ17.45
  P&L: ‚Çπ-228.75 (-14.88%)
  Exit Reason: VWAP Stop (>5% below VWAP)
  Cash: ‚Çπ99,771.25

================================================================================
[2025-12-30 11:19:59.950853+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:19:59.950853+05:30] Nifty Spot: 25922.95
[2025-12-30 11:19:59.998538] Fetching quotes for 22 options...
[2025-12-30 11:20:00.033770] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[11:20:00] Waiting 300s for next candle at 11:25:00

================================================================================
[2025-12-30 11:25:00.003166+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:25:00.003166+05:30] Nifty Spot: 25917.45
[2025-12-30 11:25:00.079361] Fetching quotes for 22 options...
[2025-12-30 11:25:00.112579] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[11:25:00] Waiting 300s for next candle at 11:30:00

================================================================================
[2025-12-30 11:30:00.000281+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:30:00.000281+05:30] Nifty Spot: 25914.95
[2025-12-30 11:30:00.046244] Fetching quotes for 22 options...
[2025-12-30 11:30:00.085443] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[11:30:00] Waiting 300s for next candle at 11:35:00

================================================================================
[2025-12-30 11:35:00.000031+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:35:20.200907] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 11:35:20.200946] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:35:00.000031+05:30] Nifty Spot: 25896.10
[2025-12-30 11:35:21.270462] Fetching quotes for 22 options...
[2025-12-30 11:35:21.302492] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[11:35:21] Waiting 279s for next candle at 11:40:00

================================================================================
[2025-12-30 11:39:59.997921+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:40:20.891048] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 11:40:20.891111] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:39:59.997921+05:30] Nifty Spot: 25895.50
[2025-12-30 11:40:21.966417] Fetching quotes for 22 options...
[2025-12-30 11:40:21.999930] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[11:40:22] Waiting 278s for next candle at 11:45:00

================================================================================
[2025-12-30 11:44:59.998936+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:45:25.479623] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 11:45:25.479652] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:44:59.998936+05:30] Nifty Spot: 25910.20
[2025-12-30 11:45:26.554892] Fetching quotes for 22 options...
[2025-12-30 11:45:26.586946] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[11:45:26] Waiting 273s for next candle at 11:50:00

================================================================================
[2025-12-30 11:49:59.998272+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:50:23.490855] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 11:50:23.490934] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:49:59.998272+05:30] Nifty Spot: 25912.50
[2025-12-30 11:50:24.578622] Fetching quotes for 22 options...
[2025-12-30 11:50:24.623896] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[11:50:24] Waiting 275s for next candle at 11:55:00

================================================================================
[2025-12-30 11:55:00.002280+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 11:55:30.019281] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2025-12-30 11:55:30.019348] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:55:00.002280+05:30] Nifty Spot: 25901.05
[2025-12-30 11:55:31.118266] Fetching quotes for 22 options...
[2025-12-30 11:55:31.152409] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[11:55:31] Waiting 269s for next candle at 12:00:00

================================================================================
[2025-12-30 11:59:59.997824+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 12:00:30.003535] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2025-12-30 12:00:30.003573] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 11:59:59.997824+05:30] Nifty Spot: 25901.75
[2025-12-30 12:00:31.083211] Fetching quotes for 22 options...
[2025-12-30 12:00:31.117723] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[12:00:31] Waiting 269s for next candle at 12:05:00

================================================================================
[2025-12-30 12:05:00.002260+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-30 12:05:23.471215] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-30 12:05:23.471270] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-30 12:05:00.002260+05:30] Nifty Spot: 25895.00
[2025-12-30 12:05:24.561114] Fetching quotes for 22 options...
[2025-12-30 12:05:24.595541] ‚úì Retrieved 22 option quotes

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-30
Broker: Zerodha
Daily Direction: PUT @ 25900.0
Open Positions: 0
Total P&L: ‚Çπ-228.75
ROI: -0.23%
--------------------------------------------------------------------------------

[12:05:24] Waiting 275s for next candle at 12:10:00
