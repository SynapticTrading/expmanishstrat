/Users/Algo_Trading/manishsir_options/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(

================================================================================
UNIVERSAL PAPER TRADING SYSTEM
================================================================================

Loading configuration...
Loading credentials from: paper_trading/config/credentials_zerodha.txt
Creating broker instance...
‚úì Broker: Zerodha

[2025-12-31 13:44:31.444479+05:30] Checking for previous session...
[2025-12-31 13:44:31.444677+05:30] ‚úì State loaded from paper_trading/state/trading_state_20251231.json

================================================================================
CRASH RECOVERY DETECTED
================================================================================
Last Activity: 2025-12-31T12:51:20.123456+05:30
Downtime: ~53 minutes
Active Positions: 1
Daily P&L: ‚Çπ0.00
================================================================================

‚ö†Ô∏è  CRITICAL: 1 open position(s) detected!
Cannot start fresh session with active positions.
Automatically resuming from crash...


================================================================================
RESUMING SESSION FROM CRASH
================================================================================
Crash Time: 2025-12-31T12:51:20.123456+05:30
Recovery Time: 2025-12-31 13:44:31.444762+05:30
Downtime: 53 minutes
Active Positions: 1
‚úì Session resumed successfully
================================================================================


[2025-12-31 13:44:31.445174+05:30] Connecting to Zerodha...
[2025-12-31 13:44:31.445187] Connecting to Zerodha...
[2025-12-31 13:44:31.652048] Generated TOTP: 002269
[2025-12-31 13:44:31.758880] ‚úì Request token extracted from redirect
[2025-12-31 13:44:31.758900] Request token obtained: rzzDxvvzeeb9vdwW9omq...
[2025-12-31 13:44:31.830242] ‚úì Connection successful!
[2025-12-31 13:44:31.830257] Access Token: M2c5aDKqTGSN0RkAThrk...
[2025-12-31 13:44:31.830276] Zerodha data feed initialized
[2025-12-31 13:44:31.830282+05:30] ‚úì Connected to Zerodha

[2025-12-31 13:44:31.830298+05:30] Resuming from previous session...
[2025-12-31 13:44:31.830316+05:30] Loading instruments...
[2025-12-31 13:44:31.830329] Loading instruments...
[2025-12-31 13:44:31.830333] Fetching instruments for NFO...
[2025-12-31 13:44:33.005650] ‚úì Retrieved 37220 instruments
[2025-12-31 13:44:33.011634] Fetching instruments for NSE...
[2025-12-31 13:44:33.135645] ‚úì Retrieved 9058 instruments
[2025-12-31 13:44:33.138697] ‚úì Nifty 50 token: 256265
[2025-12-31 13:44:33.138722] ‚úì Instruments loaded
[2025-12-31 13:44:33.138734+05:30] Initializing paper broker...
[2025-12-31 13:44:33.139350] Paper Broker initialized with capital: ‚Çπ92,072.50
[2025-12-31 13:44:33.139365] Daily trade log: paper_trading/logs/trades_20251231_134433.csv
[2025-12-31 13:44:33.139371] Cumulative trade log: paper_trading/logs/trades_cumulative.csv
[2025-12-31 13:44:33.139382] Restoring 1 position(s)...
  ‚úì Restored: CALL 26050.0 @ ‚Çπ107.40
     Size: 75, Peak: ‚Çπ176.95, Trailing: True
[2025-12-31 13:44:33.139409] ‚úì Restored 1 position(s)
[2025-12-31 13:44:33.139413] Available cash: ‚Çπ92,072.50
[2025-12-31 13:44:33.139418+05:30] Initializing OI analyzer...
[2025-12-31 13:44:33.139784+05:30] Initializing strategy...
[2025-12-31 13:44:33.139818] Strategy initialized
  Entry: 09:30:00 - 14:30:00
  Exit: 14:50:00 - 15:00:00
  Stop Loss: 25.0%
  Trailing Stop: 10.0%
  VWAP Stop: 5.0%
  OI Stop: 10.0%
[2025-12-31 13:44:33.139842+05:30] Restoring strategy state...
  Restored daily_trade_taken: True (has open positions)
  Restored direction: CALL
  Restored strike: 26200.0
  Restored expiry: 2026-01-06
[2025-12-31 13:44:33.140263+05:30] ‚úì All components initialized

================================================================================
[2025-12-31 13:44:33.140277+05:30] Starting DUAL-LOOP paper trading...
  Broker: Zerodha
  Loop 1: Strategy Loop - Every 5 minutes (Entry decisions)
  Loop 2: Exit Monitor Loop - Every 1 minute (LTP-based exits)
  MODE: RECOVERY (resumed from crash)
================================================================================

[2025-12-31 13:44:33.140411+05:30] ‚úì Exit monitor loop started (1-min LTP)
[2025-12-31 13:44:33.140586+05:30] ‚úì Exit monitor loop started
[2025-12-31 13:44:33.141349+05:30] ‚úì Strategy loop started

================================================================================
[2025-12-31 13:44:33.141371+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 13:44:33.141371+05:30] Nifty Spot: 26146.60
[2025-12-31 13:44:33.180055] Fetching quotes for 22 options...
[2025-12-31 13:44:33.140425+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:44:33.203899] Fetching quotes for 22 options...
[2025-12-31 13:44:33.219535] ‚úì Retrieved 22 option quotes

================================================================================
[2025-12-31 13:44:33.141371+05:30] ‚ö†Ô∏è  STARTED LATE (after 9:15 AM)
[2025-12-31 13:44:33.141371+05:30] Determining direction using CURRENT OI data...
[2025-12-31 13:44:33.141371+05:30] (OI buildup direction is still valid mid-day)
================================================================================


================================================================================
[2025-12-31 13:44:33.141371+05:30] NEW TRADING DAY: 2025-12-31
================================================================================
[2025-12-31 13:44:33.141371+05:30] ‚ö†Ô∏è  Open positions detected - keeping daily_trade_taken = True

================================================================================
OI DISTRIBUTION DEBUG (Spot: 26146.60)
================================================================================

CALL OI by Strike:
Strike                  OI   Distance from Spot
--------------------------------------------------
25900.0          1,410,110            -246.60
25950.0            975,650            -196.60
26000.0          5,652,725            -146.60
26050.0          2,280,525             -96.60
26100.0          5,954,780             -46.60
26150.0          4,482,985               3.40
26200.0          7,713,290              53.40 üëà MAX
26250.0          3,323,580             103.40
26300.0          5,922,345             153.40
26350.0          2,893,215             203.40
26400.0          6,998,420             253.40

PUT OI by Strike:
Strike                  OI   Distance from Spot
--------------------------------------------------
25900.0          9,201,400             246.60
25950.0          6,169,475             196.60
26000.0         20,171,775             146.60 üëà MAX
26050.0          9,311,705              96.60
26100.0         13,214,045              46.60
26150.0          6,609,525              -3.40
26200.0          6,775,145             -53.40
26250.0          1,415,310            -103.40
26300.0          2,280,135            -153.40
26350.0            408,005            -203.40
26400.0            566,215            -253.40
================================================================================

[2025-12-31 13:44:33.141371+05:30] Max Call OI: 7,713,290 @ 26200.0, Max Put OI: 20,171,775 @ 26000.0
[2025-12-31 13:44:33.141371+05:30] Direction determined: CALL (Call dist: 53.40, Put dist: 146.60)
[2025-12-31 13:44:33.141371+05:30] ‚úì Daily Analysis Complete: Direction=CALL, Strike=26150.0, Expiry=2026-01-06, Spot=26146.60
[2025-12-31 13:44:33.141371+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ186.60 | Entry: ‚Çπ107.40 | P&L: +73.74%
    Initial Stop: ‚Çπ80.55 (distance: 131.66%)
    üéØ Trailing: Active | Peak: ‚Çπ186.60 | Stop: ‚Çπ167.94

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26150.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:44:33] Waiting 27s for next candle at 13:45:00
[2025-12-31 13:44:33.236214] ‚úì Retrieved 22 option quotes
[2025-12-31 13:44:33.140425+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ186.60 | Entry: ‚Çπ107.40 | P&L: +73.74%
    Initial Stop: ‚Çπ80.55 (distance: 131.66%)
    üéØ Trailing: Active | Peak: ‚Çπ186.60 | Stop: ‚Çπ167.94

================================================================================
[2025-12-31 13:45:00.005190+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 13:45:00.005190+05:30] Nifty Spot: 26149.00
[2025-12-31 13:45:00.058548] Fetching quotes for 22 options...
[2025-12-31 13:45:00.093322] ‚úì Retrieved 22 option quotes
[2025-12-31 13:45:00.005190+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ187.40 | Entry: ‚Çπ107.40 | P&L: +74.49%
    Initial Stop: ‚Çπ80.55 (distance: 132.65%)
    üéØ Trailing: Active | Peak: ‚Çπ187.40 | Stop: ‚Çπ168.66

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26150.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:45:00] Waiting 300s for next candle at 13:50:00
[2025-12-31 13:45:33.247570+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:45:33.307572] Fetching quotes for 22 options...
[2025-12-31 13:45:33.344477] ‚úì Retrieved 22 option quotes
[2025-12-31 13:45:33.247570+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ189.05 | Entry: ‚Çπ107.40 | P&L: +76.02%
    Initial Stop: ‚Çπ80.55 (distance: 134.70%)
    üéØ Trailing: Active | Peak: ‚Çπ189.05 | Stop: ‚Çπ170.15
[2025-12-31 13:46:33.354226+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:46:33.404920] Fetching quotes for 22 options...
[2025-12-31 13:46:33.441484] ‚úì Retrieved 22 option quotes
[2025-12-31 13:46:33.354226+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ188.95 | Entry: ‚Çπ107.40 | P&L: +75.93%
    Initial Stop: ‚Çπ80.55 (distance: 134.57%)
    üéØ Trailing: Active | Peak: ‚Çπ189.05 | Stop: ‚Çπ170.15
[2025-12-31 13:47:33.448947+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:47:33.526773] Fetching quotes for 22 options...
[2025-12-31 13:47:33.566544] ‚úì Retrieved 22 option quotes
[2025-12-31 13:47:33.448947+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ192.15 | Entry: ‚Çπ107.40 | P&L: +78.91%
    Initial Stop: ‚Çπ80.55 (distance: 138.55%)
    üéØ Trailing: Active | Peak: ‚Çπ192.15 | Stop: ‚Çπ172.94
[2025-12-31 13:48:33.573926+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:48:33.637208] Fetching quotes for 22 options...
[2025-12-31 13:48:33.677797] ‚úì Retrieved 22 option quotes
[2025-12-31 13:48:33.573926+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ191.25 | Entry: ‚Çπ107.40 | P&L: +78.07%
    Initial Stop: ‚Çπ80.55 (distance: 137.43%)
    üéØ Trailing: Active | Peak: ‚Çπ192.15 | Stop: ‚Çπ172.94
[2025-12-31 13:49:33.685274+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:49:33.771869] Fetching quotes for 22 options...
[2025-12-31 13:49:33.807886] ‚úì Retrieved 22 option quotes
[2025-12-31 13:49:33.685274+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ191.70 | Entry: ‚Çπ107.40 | P&L: +78.49%
    Initial Stop: ‚Çπ80.55 (distance: 137.99%)
    üéØ Trailing: Active | Peak: ‚Çπ192.15 | Stop: ‚Çπ172.94

================================================================================
[2025-12-31 13:50:00.013693+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 13:50:00.013693+05:30] Nifty Spot: 26156.15
[2025-12-31 13:50:00.067078] Fetching quotes for 22 options...
[2025-12-31 13:50:00.101417] ‚úì Retrieved 22 option quotes
[2025-12-31 13:50:00.013693+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ193.00 | Entry: ‚Çπ107.40 | P&L: +79.70%
    Initial Stop: ‚Çπ80.55 (distance: 139.60%)
    üéØ Trailing: Active | Peak: ‚Çπ193.00 | Stop: ‚Çπ173.70

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26150.0
Open Positions: 1
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------

[13:50:00] Waiting 300s for next candle at 13:55:00
[2025-12-31 13:50:33.815074+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:50:33.879115] Fetching quotes for 22 options...
[2025-12-31 13:50:33.921626] ‚úì Retrieved 22 option quotes
[2025-12-31 13:50:33.815074+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ194.60 | Entry: ‚Çπ107.40 | P&L: +81.19%
    Initial Stop: ‚Çπ80.55 (distance: 141.59%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14
[2025-12-31 13:51:33.928481+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:51:33.993966] Fetching quotes for 22 options...
[2025-12-31 13:51:34.029847] ‚úì Retrieved 22 option quotes
[2025-12-31 13:51:33.928481+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ194.45 | Entry: ‚Çπ107.40 | P&L: +81.05%
    Initial Stop: ‚Çπ80.55 (distance: 141.40%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14
[2025-12-31 13:52:34.037188+05:30] üîç Exit Monitor: Fetching real-time LTP for 1 position(s)...
[2025-12-31 13:52:34.079744] Fetching quotes for 22 options...
[2025-12-31 13:52:34.116014] ‚úì Retrieved 22 option quotes
[2025-12-31 13:52:34.037188+05:30] üìä LTP CHECK: 26050.0 CALL
    Current LTP: ‚Çπ193.15 | Entry: ‚Çπ107.40 | P&L: +79.84%
    Initial Stop: ‚Çπ80.55 (distance: 139.79%)
    üéØ Trailing: Active | Peak: ‚Çπ194.60 | Stop: ‚Çπ175.14
