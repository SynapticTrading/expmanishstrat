================================================================================
   PAPER TRADING LAUNCHER
================================================================================
Starting paper trading...
Broker: zerodha
Log file: /Users/Algo_Trading/manishsir_options/paper_trading/logs/session_log_20260109_123743.txt
Press Ctrl+C to stop
================================================================================

================================================================================
UNIVERSAL PAPER TRADING SYSTEM
================================================================================
Loading configuration...
Loading credentials from: /Users/Algo_Trading/manishsir_options/paper_trading/config/credentials_zerodha.txt
Creating broker instance...
‚úì Broker: Zerodha

[2026-01-09 12:37:43.799944+05:30] Checking for previous session...
[2026-01-09 12:37:43.800097+05:30] No previous state found - starting fresh

[2026-01-09 12:37:43.800140+05:30] Connecting to Zerodha...
[2026-01-09 12:37:43.800176] Connecting to Zerodha...
[2026-01-09 12:37:43.967506] Generated TOTP: 987845
[2026-01-09 12:37:44.074420] ‚úì Request token extracted from redirect
[2026-01-09 12:37:44.074586] Request token obtained: am2G4mKgOAUKS10zjY2F...
[2026-01-09 12:37:44.138696] ‚úì Connection successful!
[2026-01-09 12:37:44.138854] Access Token: 6qLO8LM2oCuHMws6ATtN...
[2026-01-09 12:37:44.138912] Zerodha data feed initialized
[2026-01-09 12:37:44.138952+05:30] ‚úì Connected to Zerodha

[2026-01-09 12:37:44.139003+05:30] Initializing new session...
[2026-01-09 12:37:44.142086+05:30] üÜï First session - Starting with ‚Çπ100,000.00
[2026-01-09 12:37:44.142749+05:30] Session initialized: SESSION_20260109_1237
[2026-01-09 12:37:44.142810+05:30] State file: /Users/Algo_Trading/manishsir_options/paper_trading/state/trading_state_zerodha_20260109.json
[2026-01-09 12:37:44.142866+05:30] Loading instruments...
[2026-01-09 12:37:44.142904] Loading instruments...
[2026-01-09 12:37:44.142939] Fetching instruments for NFO...
[2026-01-09 12:37:45.276551] ‚úì Retrieved 40424 instruments
[2026-01-09 12:37:45.283501] Fetching instruments for NSE...
[2026-01-09 12:37:45.402072] ‚úì Retrieved 9108 instruments
[2026-01-09 12:37:45.404305] ‚úì Nifty 50 token: 256265
[2026-01-09 12:37:45.404379] ‚úì Instruments loaded
[2026-01-09 12:37:45.404414+05:30] Initializing contract manager (reading from universal cache)...
Loaded 18 options expiries from cache (cached at: 2026-01-09T12:37:03.113143)
Options lot size: 65 units per lot
‚úì Loaded contracts from universal cache: /Users/Algo_Trading/manishsir_options/contracts_cache.json
[2026-01-09 12:37:45.405125+05:30] ‚úì Contract manager initialized
[2026-01-09 12:37:45.405177+05:30] Active Weekly Expiry: 2026-01-13 (4 days)
[2026-01-09 12:37:45.405220+05:30] Initializing paper broker...
[2026-01-09 12:37:45.405597] Paper Broker initialized with capital: ‚Çπ100,000.00
[2026-01-09 12:37:45.405638] Daily trade log: /Users/Algo_Trading/manishsir_options/paper_trading/logs/trades_20260109_123745.csv
[2026-01-09 12:37:45.405663] Cumulative trade log: /Users/Algo_Trading/manishsir_options/paper_trading/logs/trades_cumulative.csv
[2026-01-09 12:37:45.405692+05:30] Initializing OI analyzer...
[2026-01-09 12:37:45.406024+05:30] Initializing strategy...
[2026-01-09 12:37:45.406082] Strategy initialized
  Entry: 09:30:00 - 15:28:00
  Exit: 15:29:00 - 15:30:00
  Stop Loss: 25.0%
  Trailing Stop: 10.0%
  VWAP Stop: 5.0%
  OI Stop: 10.0%
[2026-01-09 12:37:45.406484+05:30] ‚úì All components initialized

================================================================================
[2026-01-09 12:37:45.406546+05:30] Starting DUAL-LOOP paper trading...
  Broker: Zerodha
  Loop 1: Strategy Loop - Every 5 minutes (Entry decisions)
  Loop 2: Exit Monitor Loop - Every 1 minute (LTP-based exits)
================================================================================
[2026-01-09 12:37:45.406745+05:30] ‚úì Exit monitor loop started (1-min LTP)
[2026-01-09 12:37:45.406814+05:30] ‚úì Exit monitor loop started
[2026-01-09 12:37:45.406949+05:30] ‚úì Contract monitor loop started (checks every 300s)
[2026-01-09 12:37:45.407038+05:30] ‚úì Contract monitor loop started (checks every 300s)
[2026-01-09 12:37:45.407403+05:30] ‚úì Strategy loop started

================================================================================
[2026-01-09 12:37:45.407440+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================
[2026-01-09 12:37:45.407440+05:30] Nifty Spot: 25691.05
[2026-01-09 12:37:45.446297] Fetching quotes for 22 options...
[2026-01-09 12:37:45.474099] ‚úì Retrieved 22 option quotes

================================================================================
[2026-01-09 12:37:45.407440+05:30] ‚ö†Ô∏è  STARTED LATE (after 9:15 AM)
[2026-01-09 12:37:45.407440+05:30] Determining direction using CURRENT OI data...
[2026-01-09 12:37:45.407440+05:30] (OI buildup direction is still valid mid-day)
================================================================================

================================================================================
[2026-01-09 12:37:45.407440+05:30] NEW TRADING DAY: 2026-01-09
================================================================================

================================================================================
OI DISTRIBUTION DEBUG (Spot: 25691.05)
================================================================================

CALL OI by Strike:
Strike                  OI   Distance from Spot
--------------------------------------------------
25450.0             45,370            -241.05
25500.0            858,585            -191.05
25550.0            149,240            -141.05
25600.0          1,372,605             -91.05
25650.0            744,965             -41.05
25700.0          5,230,680               8.95
25750.0          6,068,465              58.95
25800.0         14,296,815             108.95
25850.0          9,675,120             158.95
25900.0         19,625,905             208.95 üëà MAX
25950.0          9,681,165             258.95

PUT OI by Strike:
Strike                  OI   Distance from Spot
--------------------------------------------------
25450.0          2,491,125             241.05
25500.0         11,128,325             191.05
25550.0          4,138,680             141.05
25600.0         12,464,205              91.05
25650.0          5,076,305              41.05
25700.0         13,572,585              -8.95 üëà MAX
25750.0          7,332,845             -58.95
25800.0         10,357,035            -108.95
25850.0          4,533,100            -158.95
25900.0          6,626,555            -208.95
25950.0          2,403,245            -258.95
================================================================================
[2026-01-09 12:37:45.407440+05:30] Max Call OI: 19,625,905 @ 25900.0, Max Put OI: 13,572,585 @ 25700.0
[2026-01-09 12:37:45.407440+05:30] Direction determined: PUT (Call dist: 208.95, Put dist: -8.95)
[2026-01-09 12:37:45.407440+05:30] ‚úì Daily Analysis Complete: Direction=PUT, Strike=25650.0, Expiry=2026-01-13, Spot=25691.05
[2026-01-09 12:37:45.407440+05:30] üîÑ Reset VWAP running totals for new day: 2026-01-09
[2026-01-09 12:37:45.407440+05:30] üéØ Initialized VWAP for PUT 25650.0: 41 bars from 9:15 AM
[2026-01-09 12:37:45.407440+05:30] Checking entry: PUT 25650.0, Expiry=2026-01-13
[2026-01-09 12:37:45.407440+05:30] PUT 25650.0: OI=5,076,305, Change=0 (+0.00%) - BUILDING
[2026-01-09 12:37:45.407440+05:30] PUT 25650.0: Price=‚Çπ67.25, VWAP=‚Çπ67.25 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2026-01-09
Broker: Zerodha
Daily Direction: PUT @ 25650.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------
[12:37:45] Waiting 135s for next candle at 12:40:00

================================================================================
[2026-01-09 12:40:00.005515+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================
[2026-01-09 12:40:00.005515+05:30] Nifty Spot: 25694.40
[2026-01-09 12:40:00.059551] Fetching quotes for 22 options...
[2026-01-09 12:40:00.106919] ‚úì Retrieved 22 option quotes
[2026-01-09 12:40:00.005515+05:30] Checking entry: PUT 25650.0, Expiry=2026-01-13
[2026-01-09 12:40:00.005515+05:30] PUT 25650.0: OI=4,638,530, Change=-437,775 (-8.62%) - UNWINDING ‚úì
[2026-01-09 12:40:00.005515+05:30] PUT 25650.0: Price=‚Çπ66.20, VWAP=‚Çπ66.71 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2026-01-09
Broker: Zerodha
Daily Direction: PUT @ 25650.0
Open Positions: 0
Total P&L: ‚Çπ0.00
ROI: +0.00%
--------------------------------------------------------------------------------
[12:40:00] Waiting 300s for next candle at 12:45:00
Cache file no longer exists

================================================================================
[2026-01-09 12:45:00.005975+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================
[2026-01-09 12:45:30.013126] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2026-01-09 12:45:30.013240] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2026-01-09 12:45:31.082241] ‚ö†Ô∏è  Error getting LTP: Incorrect `api_key` or `access_token`.
[2026-01-09 12:45:31.082449] ‚ö†Ô∏è  Retrying in 2s... (attempt 2/3)
[2026-01-09 12:45:33.119289] ‚úó Failed to get LTP after 3 attempts: Incorrect `api_key` or `access_token`.
[2026-01-09 12:45:33.119488] ‚ö†Ô∏è  Spot price returned None, retrying in 1s... (attempt 1/3)
[2026-01-09 12:45:34.151763] ‚ö†Ô∏è  Error getting LTP: Incorrect `api_key` or `access_token`.
[2026-01-09 12:45:34.152038] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2026-01-09 12:45:35.190502] ‚ö†Ô∏è  Error getting LTP: Incorrect `api_key` or `access_token`.
[2026-01-09 12:45:35.193436] ‚ö†Ô∏è  Retrying in 2s... (attempt 2/3)
[2026-01-09 12:45:37.224431] ‚úó Failed to get LTP after 3 attempts: Incorrect `api_key` or `access_token`.
[2026-01-09 12:45:37.224697] ‚ö†Ô∏è  Spot price returned None, retrying in 2s... (attempt 2/3)
[2026-01-09 12:45:39.270650] ‚ö†Ô∏è  Error getting LTP: Incorrect `api_key` or `access_token`.
[2026-01-09 12:45:39.270966] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2026-01-09 12:45:40.318425] ‚ö†Ô∏è  Error getting LTP: Incorrect `api_key` or `access_token`.
[2026-01-09 12:45:40.318754] ‚ö†Ô∏è  Retrying in 2s... (attempt 2/3)
[2026-01-09 12:45:42.378001] ‚úó Failed to get LTP after 3 attempts: Incorrect `api_key` or `access_token`.
[2026-01-09 12:45:00.005975+05:30] ‚úó Failed to get spot price, skipping...
[12:45:42] Waiting 258s for next candle at 12:50:00
======================================================================
CACHE FILE UPDATED - RELOADING CONTRACTS
======================================================================
Previous mtime: 1767942423.1137671
Current mtime:  1767942772.7232635
Loaded 18 options expiries from cache (cached at: 2026-01-09T12:42:52.722884)
Options lot size: 65 units per lot
‚úì Contracts reloaded successfully
  Options: 18 expiry dates
  Active Options: 2026-01-13 (4 days)
======================================================================
[2026-01-09 12:47:45.421123+05:30] ‚úì Contracts reloaded from cronjob update
[2026-01-09 12:47:45.421226+05:30] Active Weekly Expiry: 2026-01-13 (4 days)

================================================================================
[2026-01-09 12:50:00.002414+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================
[2026-01-09 12:50:30.020215] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2026-01-09 12:50:30.020589] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2026-01-09 12:50:31.079759] ‚ö†Ô∏è  Error getting LTP: Incorrect `api_key` or `access_token`.
[2026-01-09 12:50:31.079879] ‚ö†Ô∏è  Retrying in 2s... (attempt 2/3)
[2026-01-09 12:50:33.110845] ‚úó Failed to get LTP after 3 attempts: Incorrect `api_key` or `access_token`.
[2026-01-09 12:50:33.111012] ‚ö†Ô∏è  Spot price returned None, retrying in 1s... (attempt 1/3)
[2026-01-09 12:50:34.139269] ‚ö†Ô∏è  Error getting LTP: Incorrect `api_key` or `access_token`.
[2026-01-09 12:50:34.139455] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2026-01-09 12:50:35.167923] ‚ö†Ô∏è  Error getting LTP: Incorrect `api_key` or `access_token`.
[2026-01-09 12:50:35.168137] ‚ö†Ô∏è  Retrying in 2s... (attempt 2/3)
[2026-01-09 12:50:37.201930] ‚úó Failed to get LTP after 3 attempts: Incorrect `api_key` or `access_token`.
[2026-01-09 12:50:37.202198] ‚ö†Ô∏è  Spot price returned None, retrying in 2s... (attempt 2/3)
