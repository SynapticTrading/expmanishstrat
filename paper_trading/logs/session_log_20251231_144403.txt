/Users/Algo_Trading/manishsir_options/venv/lib/python3.9/site-packages/urllib3/__init__.py:35: NotOpenSSLWarning: urllib3 v2 only supports OpenSSL 1.1.1+, currently the 'ssl' module is compiled with 'LibreSSL 2.8.3'. See: https://github.com/urllib3/urllib3/issues/3020
  warnings.warn(

================================================================================
UNIVERSAL PAPER TRADING SYSTEM
================================================================================

Loading configuration...
Loading credentials from: paper_trading/config/credentials_zerodha.txt
Creating broker instance...
‚úì Broker: Zerodha

[2025-12-31 14:44:04.962737+05:30] Checking for previous session...
[2025-12-31 14:44:04.963055+05:30] ‚úì State loaded from paper_trading/state/trading_state_20251231.json

================================================================================
CRASH RECOVERY DETECTED
================================================================================
Last Activity: 2025-12-31T14:15:00.000000+05:30
Downtime: ~29 minutes
Active Positions: 0
Daily P&L: ‚Çπ6,420.00
================================================================================

Resume from crash? (y/n): 
[2025-12-31 14:44:09.261525+05:30] Resuming session...

================================================================================
RESUMING SESSION FROM CRASH
================================================================================
Crash Time: 2025-12-31T14:15:00.000000+05:30
Recovery Time: 2025-12-31 14:44:09.261791+05:30
Downtime: 29 minutes
Active Positions: 0
‚úì Session resumed successfully
================================================================================


[2025-12-31 14:44:09.262850+05:30] Connecting to Zerodha...
[2025-12-31 14:44:09.262896] Connecting to Zerodha...
[2025-12-31 14:44:09.564013] Generated TOTP: 135243
[2025-12-31 14:44:09.693810] ‚úì Request token extracted from redirect
[2025-12-31 14:44:09.693840] Request token obtained: emRkq7O1jyPtGlmGHcZx...
[2025-12-31 14:44:09.782028] ‚úì Connection successful!
[2025-12-31 14:44:09.782055] Access Token: VCfsWD4yhjt1RKQrAK1E...
[2025-12-31 14:44:09.782115] Zerodha data feed initialized
[2025-12-31 14:44:09.782130+05:30] ‚úì Connected to Zerodha

[2025-12-31 14:44:09.782165+05:30] Resuming from previous session...
[2025-12-31 14:44:09.782198+05:30] Loading instruments...
[2025-12-31 14:44:09.782208] Loading instruments...
[2025-12-31 14:44:09.782215] Fetching instruments for NFO...
[2025-12-31 14:44:10.857369] ‚úì Retrieved 37220 instruments
[2025-12-31 14:44:10.864405] Fetching instruments for NSE...
[2025-12-31 14:44:10.989988] ‚úì Retrieved 9058 instruments
[2025-12-31 14:44:10.992435] ‚úì Nifty 50 token: 256265
[2025-12-31 14:44:10.992451] ‚úì Instruments loaded
[2025-12-31 14:44:10.992459+05:30] Initializing paper broker...
[2025-12-31 14:44:10.992954] Paper Broker initialized with capital: ‚Çπ106,547.50
[2025-12-31 14:44:10.992967] Daily trade log: paper_trading/logs/trades_20251231_144410.csv
[2025-12-31 14:44:10.992971] Cumulative trade log: paper_trading/logs/trades_cumulative.csv
[2025-12-31 14:44:10.992981] Restoring 1 closed trade(s)...
  ‚úì Restored trade: CALL 26050.0 | P&L: ‚Çπ+6,420.00
[2025-12-31 14:44:10.993002] ‚úì Restored 1 closed trade(s)
[2025-12-31 14:44:10.993006+05:30] Initializing OI analyzer...
[2025-12-31 14:44:10.993320+05:30] Initializing strategy...
[2025-12-31 14:44:10.993345] Strategy initialized
  Entry: 09:30:00 - 15:28:00
  Exit: 15:29:00 - 15:30:00
  Stop Loss: 25.0%
  Trailing Stop: 10.0%
  VWAP Stop: 5.0%
  OI Stop: 10.0%
[2025-12-31 14:44:10.993367+05:30] Restoring strategy state...
  Restored daily_trade_taken: True (has closed trades, trades_today=1)
  Restored direction: CALL
  Restored strike: 26200.0
  Restored expiry: None
[2025-12-31 14:44:10.993739+05:30] ‚úì All components initialized

================================================================================
[2025-12-31 14:44:10.993760+05:30] Starting DUAL-LOOP paper trading...
  Broker: Zerodha
  Loop 1: Strategy Loop - Every 5 minutes (Entry decisions)
  Loop 2: Exit Monitor Loop - Every 1 minute (LTP-based exits)
  MODE: RECOVERY (resumed from crash)
================================================================================

[2025-12-31 14:44:10.993867+05:30] ‚úì Exit monitor loop started (1-min LTP)
[2025-12-31 14:44:10.993896+05:30] ‚úì Exit monitor loop started
[2025-12-31 14:44:10.994184+05:30] ‚úì Strategy loop started

================================================================================
[2025-12-31 14:44:10.994195+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 14:44:10.994195+05:30] Nifty Spot: 26181.00
[2025-12-31 14:44:11.038306] Fetching quotes for 22 options...
[2025-12-31 14:44:11.073000] ‚úì Retrieved 22 option quotes

================================================================================
[2025-12-31 14:44:10.994195+05:30] ‚ö†Ô∏è  STARTED LATE (after 9:15 AM)
[2025-12-31 14:44:10.994195+05:30] Determining direction using CURRENT OI data...
[2025-12-31 14:44:10.994195+05:30] (OI buildup direction is still valid mid-day)
================================================================================


================================================================================
[2025-12-31 14:44:10.994195+05:30] NEW TRADING DAY: 2025-12-31
================================================================================

================================================================================
OI DISTRIBUTION DEBUG (Spot: 26181.00)
================================================================================

CALL OI by Strike:
Strike                  OI   Distance from Spot
--------------------------------------------------
25950.0            900,640            -231.00
26000.0          5,173,675            -181.00
26050.0          1,960,465            -131.00
26100.0          5,417,620             -81.00
26150.0          4,536,805             -31.00
26200.0          8,105,760              19.00 üëà MAX
26250.0          3,343,275              69.00
26300.0          5,996,055             119.00
26350.0          2,696,915             169.00
26400.0          7,650,240             219.00
26450.0          2,669,030             269.00

PUT OI by Strike:
Strike                  OI   Distance from Spot
--------------------------------------------------
25950.0          6,135,740             231.00
26000.0         19,385,275             181.00 üëà MAX
26050.0          9,136,140             131.00
26100.0         13,109,070              81.00
26150.0          7,113,470              31.00
26200.0          7,784,660             -19.00
26250.0          1,662,310             -69.00
26300.0          2,517,125            -119.00
26350.0            486,395            -169.00
26400.0            613,795            -219.00
26450.0            121,615            -269.00
================================================================================

[2025-12-31 14:44:10.994195+05:30] Max Call OI: 8,105,760 @ 26200.0, Max Put OI: 19,385,275 @ 26000.0
[2025-12-31 14:44:10.994195+05:30] Direction determined: CALL (Call dist: 19.00, Put dist: 181.00)
[2025-12-31 14:44:10.994195+05:30] ‚úì Daily Analysis Complete: Direction=CALL, Strike=26200.0, Expiry=2026-01-06, Spot=26181.00
[2025-12-31 14:44:10.994195+05:30] üîÑ Reset VWAP running totals for new day: 2025-12-31
[2025-12-31 14:44:10.994195+05:30] üéØ Initialized VWAP for CALL 26200.0: 66 bars from 9:15 AM
[2025-12-31 14:44:10.994195+05:30] Checking entry: CALL 26200.0, Expiry=2026-01-06
[2025-12-31 14:44:10.994195+05:30] CALL 26200.0: OI=8,105,760, Change=0 (+0.00%) - BUILDING
[2025-12-31 14:44:10.994195+05:30] CALL 26200.0: Price=‚Çπ99.45, VWAP=‚Çπ99.45 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26200.0
Open Positions: 0
Total P&L: ‚Çπ6,420.00
ROI: +6.03%
--------------------------------------------------------------------------------

[14:44:11] Waiting 49s for next candle at 14:45:00

================================================================================
[2025-12-31 14:45:00.003498+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 14:45:00.003498+05:30] Nifty Spot: 26184.00
[2025-12-31 14:45:00.054640] Fetching quotes for 22 options...
[2025-12-31 14:45:00.094716] ‚úì Retrieved 22 option quotes
[2025-12-31 14:45:00.003498+05:30] Checking entry: CALL 26200.0, Expiry=2026-01-06
[2025-12-31 14:45:00.003498+05:30] CALL 26200.0: OI=8,168,290, Change=62,530 (+0.77%) - BUILDING
[2025-12-31 14:45:00.003498+05:30] CALL 26200.0: Price=‚Çπ100.10, VWAP=‚Çπ99.78 - ABOVE ‚úì

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26200.0
Open Positions: 0
Total P&L: ‚Çπ6,420.00
ROI: +6.03%
--------------------------------------------------------------------------------

[14:45:00] Waiting 300s for next candle at 14:50:00

================================================================================
[2025-12-31 14:50:00.003429+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 14:50:30.009719] ‚ö†Ô∏è  Error getting LTP: HTTPSConnectionPool(host='api.kite.trade', port=443): Read timed out. (read timeout=30)
[2025-12-31 14:50:30.009777] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-31 14:50:00.003429+05:30] Nifty Spot: 26182.40
[2025-12-31 14:50:31.090997] Fetching quotes for 22 options...
[2025-12-31 14:50:31.125406] ‚úì Retrieved 22 option quotes
[2025-12-31 14:50:00.003429+05:30] Checking entry: CALL 26200.0, Expiry=2026-01-06
[2025-12-31 14:50:00.003429+05:30] CALL 26200.0: OI=8,293,155, Change=187,395 (+2.31%) - BUILDING
[2025-12-31 14:50:00.003429+05:30] CALL 26200.0: Price=‚Çπ97.50, VWAP=‚Çπ99.01 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26200.0
Open Positions: 0
Total P&L: ‚Çπ6,420.00
ROI: +6.03%
--------------------------------------------------------------------------------

[14:50:31] Waiting 269s for next candle at 14:55:00

================================================================================
[2025-12-31 14:55:00.001947+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 14:55:25.538981] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-31 14:55:25.539060] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-31 14:55:00.001947+05:30] Nifty Spot: 26181.60
[2025-12-31 14:55:26.603623] Fetching quotes for 22 options...
[2025-12-31 14:55:26.633854] ‚úì Retrieved 22 option quotes
[2025-12-31 14:55:00.001947+05:30] Checking entry: CALL 26200.0, Expiry=2026-01-06
[2025-12-31 14:55:00.001947+05:30] CALL 26200.0: OI=8,056,750, Change=-49,010 (-0.60%) - UNWINDING ‚úì
[2025-12-31 14:55:00.001947+05:30] CALL 26200.0: Price=‚Çπ98.30, VWAP=‚Çπ98.83 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26200.0
Open Positions: 0
Total P&L: ‚Çπ6,420.00
ROI: +6.03%
--------------------------------------------------------------------------------

[14:55:26] Waiting 273s for next candle at 15:00:00

================================================================================
[2025-12-31 15:00:00.003498+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 15:00:20.336041] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-31 15:00:20.336094] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-31 15:00:00.003498+05:30] Nifty Spot: 26159.40
[2025-12-31 15:00:21.415070] Fetching quotes for 22 options...
[2025-12-31 15:00:21.454215] ‚úì Retrieved 22 option quotes
[2025-12-31 15:00:00.003498+05:30] Checking entry: CALL 26200.0, Expiry=2026-01-06
[2025-12-31 15:00:00.003498+05:30] CALL 26200.0: OI=7,981,155, Change=-124,605 (-1.54%) - UNWINDING ‚úì
[2025-12-31 15:00:00.003498+05:30] CALL 26200.0: Price=‚Çπ94.10, VWAP=‚Çπ97.85 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26200.0
Open Positions: 0
Total P&L: ‚Çπ6,420.00
ROI: +6.03%
--------------------------------------------------------------------------------

[15:00:21] Waiting 279s for next candle at 15:05:00

================================================================================
[2025-12-31 15:05:00.030874+05:30] STRATEGY LOOP - Processing 5-min candle...
================================================================================

[2025-12-31 15:05:26.090081] ‚ö†Ô∏è  Error getting LTP: ('Connection aborted.', TimeoutError(60, 'Operation timed out'))
[2025-12-31 15:05:26.090158] ‚ö†Ô∏è  Retrying in 1s... (attempt 1/3)
[2025-12-31 15:05:00.030874+05:30] Nifty Spot: 26132.55
[2025-12-31 15:05:27.176412] Fetching quotes for 22 options...
[2025-12-31 15:05:27.209128] ‚úì Retrieved 22 option quotes
[2025-12-31 15:05:00.030874+05:30] üìç STRIKE UPDATED: 26200.0 ‚Üí 26150.0 (Spot: 26132.55)
[2025-12-31 15:05:00.030874+05:30] üéØ Initialized VWAP for CALL 26150.0: 71 bars from 9:15 AM
[2025-12-31 15:05:00.030874+05:30] Checking entry: CALL 26150.0, Expiry=2026-01-06
[2025-12-31 15:05:00.030874+05:30] CALL 26150.0: OI=4,269,200, Change=0 (+0.00%) - BUILDING
[2025-12-31 15:05:00.030874+05:30] CALL 26150.0: Price=‚Çπ115.60, VWAP=‚Çπ115.60 - BELOW ‚úó

--------------------------------------------------------------------------------
STATUS UPDATE
--------------------------------------------------------------------------------
Date: 2025-12-31
Broker: Zerodha
Daily Direction: CALL @ 26150.0
Open Positions: 0
Total P&L: ‚Çπ6,420.00
ROI: +6.03%
--------------------------------------------------------------------------------

[15:05:27] Waiting 273s for next candle at 15:10:00
